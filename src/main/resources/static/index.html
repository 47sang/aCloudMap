<!--
	此示例下载自 https://echarts.apache.org/examples/zh/editor.html?c=treemap-visual
-->
<!DOCTYPE html>
<html lang="zh_CN" style="height: 100%">

<head>
  <title>A股大盘云图</title>
  <meta charset="utf-8">
</head>

<body style="height: 100%; margin: 0">
  <div id="container" style="height: 100%"></div>

  <script type="text/javascript" src="https://registry.npmmirror.com/jquery/3.7.1/files/dist/jquery.min.js"></script>
  <script type="text/javascript" src="https://registry.npmmirror.com/echarts/5.5.1/files/dist/echarts.min.js"></script>


  <script type="text/javascript">
    var dom = document.getElementById('container');
    var myChart = echarts.init(dom, null, {
      renderer: 'canvas',
      useDirtyRect: false
    });
    var app = {};
    var ROOT_PATH = '';
    var option;

    myChart.showLoading();
    const household_america_2012 = 113616229;
    $.get(
      ROOT_PATH + './data.json',
      function (obama_budget_2012) {
        myChart.hideLoading();

        convertData(obama_budget_2012);

        function getColorData(value) {
          // 如果 x 不在任何一个区间内
          rgb = "#424453";

          if ( value < -4) {
            rgb = "#00ff4d";
          }
          if (value >= -4 && value < -3) {
            rgb = "#00d641";
          }
          if (value >= -3 && value < -2) {
            rgb = "#1aa448";
          }
          if (value >= -2 && value < -1) {
            rgb = "#0e6f2f";
          }
          if (value >= -1 && value < 0) {
            rgb = "#0e4922";
          }
          if (value === 0) {
            // 中间值
            rgb = "#424453";
          }
          if (value > 0 && value <= 1) {
            rgb = "#491414";
          }
          if (value > 1 && value <= 2) {
            rgb = "#961010";
          }
          if (value > 2 && value <= 3) {
            rgb = "#be0808";
          }
          if (value > 3 && value <= 4) {
            rgb = "#f11010";
          }
          if (value > 4) {
            rgb = "#ff0000";
          }
          return rgb;
        }

        function convertData(originList) {

          for (let i = 0; i < originList.length; i++) {
            let node = originList[i];
            if (node) {
              let value = node.increase;
              if (node.increase || value == 0) {
                node.itemStyle = {
                  color: getColorData(value)
                }
              }

              if (node.children) {
                convertData(node.children);
              }
            }
          }
        }
        function isValidNumber(num) {
          return num != null && isFinite(num);
        }
        myChart.setOption(
          (option = {
            title: {
              top: 15,
              left: 'center',
              text: 'A股大盘云图',
            },
            tooltip: {
              formatter: function (info) {
                let value = info.value;
                let data = info.data;
                let amount = data.total;
                amount = isValidNumber(amount)
                  ? '￥' + echarts.format.addCommas(amount)
                  : '-';
                let price = data.price;
                price = isValidNumber(price)
                  ? '￥' + echarts.format.addCommas(price)
                  : '-';
                let change = data.increase;
                change = isValidNumber(change) ? change.toFixed(2) + '%' : '-';
                return [
                  '<div class="tooltip-title">' +
                  echarts.format.encodeHTML(data.name) +
                  '</div>',
                  '当前市值: &nbsp;&nbsp;' + amount + '<br>',
                  // 'Per Household: &nbsp;&nbsp;' + perHousehold + '<br>',
                  '当前价格: &nbsp;&nbsp;' + price + '<br>',
                  '涨跌幅: &nbsp;&nbsp;' + change
                ].join('');
              }
            },
            series: [
              {
                name: 'A股',
                top: 80,
                type: 'treemap',
                label: {
                  show: true,
                  formatter: '{b}'
                },
                itemStyle: {
                  borderColor: 'black'
                },
                levels: [
                  {
                    itemStyle: {
                      borderWidth: 3,
                      borderColor: '#333',
                      gapWidth: 4
                    }
                  },
                  {
                    color: ["#00d641",
                      "#1aa448",
                      "#0e6f2f",
                      "#085421",
                      "#424453",
                      "#6d1414",
                      "#961010",
                      "#be0808",
                      "#e41414"],
                    colorMappingBy: 'value',
                    itemStyle: {
                      gapWidth: 2
                    }
                  }
                ],
                data: obama_budget_2012
              }
            ]
          })
        );
      }
    );

    if (option && typeof option === 'object') {
      myChart.setOption(option);
    }

    window.addEventListener('resize', myChart.resize);
  </script>
</body>

</html>